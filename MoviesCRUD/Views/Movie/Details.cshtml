@model MoviesCRUD.Models.ViewModel.MovieDetailsVM
﻿@using MoviesCRUD.Models.ViewModel;
@using Microsoft.AspNetCore.Identity;
@inject UserManager<IdentityUser> userManager;

@{
    ViewData["Title"] = "Details";
}


<div>
    <h4>Movie</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
           Image
        </dt>
        <dd class="col-sm-10">
            @*@Html.DisplayFor(model => model.ImagePath)*@
            <img src="~/@Model.Movie.ImagePath" alt="Movie Image" class="img-fluid" width="100px" height="100px" />
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Movie.MovieName)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Movie.MovieName)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Movie.MovieDescription)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Movie.MovieDescription)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Movie.MovieGenre)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Movie.MovieGenre)
        </dd>
    </dl>
</div>

<div>
    <a asp-action="Update" asp-route-id="@Model?.Movie.MovieId">Edit</a> |
    <a asp-action="UpdateImage" asp-route-id="@Model?.Movie.MovieId">Change Image</a> |
    <a asp-action="Index">Back to List</a>
</div>

@if (User.Identity.IsAuthenticated)
{
    @if (!ViewBag.HasRated)
    {
        <partial name="../Rating/_AddRating" model="@Model.Movie.MovieId" />
    }
}
<hr />

<h2>Comment Section</h2>
@if (User.Identity.IsAuthenticated)
{
    <partial name="../Comment/_AddComment" model="@Model.Movie.MovieId" />

}
else
{
    <h4 class="text-info">Login In to comment!</h4>
}
<div id="commentList">
    <partial name="../Comment/_ViewComment" model="@Model.Comments" />
</div>
@section Scripts{
    <script>
            function AddComment() {
                var movieId = $('#MovieId').val();
                var text = $('#commentBox').val();
                $('#commentBox').val('');

                $.ajax({
                    url: '@Url.Action("AddComment", "Comment")',
                    type: 'POST',
                    data: { MovieId: movieId, Text: text },
                    success: function (result) {
                       // $('#discussionList').html(result);
                       console.log(result);
                    },
                    error: function (xhr, status, error) {
                        console.log(error);
                    }
                });
            }
        $(document).ready(function () {
            $('#AddComment').submit(function (event) {
                event.preventDefault();
                var commentText = $('#commentBox').val().trim();
                if (commentText === '') {
                    $('#commentValidation').text('Please enter a comment.');
                    return false;
                }
                AddComment();

            });
        });
     

        </script>
    }